# DeepWhistleDataGeneration
A collection of utilities, based on [DeepWhistle](https://github.com/Paul-LiPu/DeepWhistle)'s generator, to generate data from audio files and *[silbido](https://github.com/MarineBioAcousticsRC/silbido)* annotation files.

The interface is the same as [DeepWhistle](https://github.com/Paul-LiPu/DeepWhistle)'s. The difference here is in the manner whereby the annotations are drawn to the golden label images. NOTE, the difference means that this version was NOT used in [Learning Deep Models from Synthetic Data for Extracting Dolphin Whistle Contours](https://arxiv.org/abs/2005.08894) and that this data processing WILL lead to a different outcome.

This makes use of a slightly modified version of [silbidopy](https://github.com/joshua-zingale/silbidopy), which is included in this repository.

## Image Generator
This utility will process audiofiles alongside *silbido* annotation files to generate spectrogram images and corresponding label-mask images.
You can call the image generator with the following:
```bash
python generate_images.py --audio_dir PATH_TO_AUDIO_FILES  \ 
  --annotation_dir PATH_TO_ANNOTATION_FILES --output_dir PATH_TO_OUTPUT_SPECTROGRAM
```
There are also more parameters that may be inspected with
```bash
python generate_images.py -h
```

## HDF5 Generator
This utility will process audiofiles alongside *silbido* annotation files to generate an HDF5 file that contains spectrogram-image and annotation-mask pairs as two-dimensional arrays. Each datum is a patch from the spectrogram, by default a 64x64 patch. By manually setting the patch size and advance, there can be overlap in the generated data.

To call the HDF5 generator with default arguments, use 
```bash
python generate_hdf5.py --audio_dir PATH_TO_AUDIO_FILES  \ 
  --annotation_dir PATH_TO_ANNOTATION_FILES --output_file OUTPUT_FILE_NAME
```
There are also more parameters that may be inspected with
```bash
python generate_hdf5.py -h
```
## Split Data
This utility will take one HDF5 file generated by the HDF5 generator and then split it into one that contains only the positive data, i.e. those having a mask with at least one whistle marked therein, and the negative data, i.e. those with empty masks.

You may split the data generated from the HDF5 generator by using
```bash
python split_hdf5_positive_negative.py INPUT_HDF5_FILE OUTPUT_DIRECTORY
```
which will create two HDF5 files with default names unless specified by the optional arguments, which themselves may be inspected with
```bash
python split_hdf5_positive_negative.py -h
```
